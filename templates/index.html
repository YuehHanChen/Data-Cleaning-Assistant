<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Data Cleaning Assistant</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/styles.css') }}">
</head>

<body>
    <h1>Data Cleaning Assistant 👨‍💻</h1>
    <p style="text-align: center;">We use OpenAI's GPT 3 model to suggest data cleaning tasks for a given dataset.<br>Simply
        enter your OpenAI API key and upload a CSV file to get started.</p>
    <form action="/" method="POST" enctype="multipart/form-data">
        <label for="apikey">🔑 OpenAI API Key:</label>
        <input type="text" id="apikey" name="apikey" placeholder="Enter your OpenAI API key" required>
        <small>Get your API key at <a href="https://platform.openai.com/account/api-keys"
                target="_blank">https://platform.openai.com/account/api-keys</a></small>
        <br>
        <br>
        <label for="datafile">💾 Upload a Dataset file (.csv):</label>
        <input type="file" name="datafile" accept=".csv">
        <input type="submit" value="Upload">
    </form>
    <div id="warning">
        <p>⚠️ <strong>Warning:</strong> Do not upload any sensitive or confidential data, as OpenAI might use it to
            train its model. We will only randomly select 50 rows to assess the dataset; the suggestion might not be
            sufficient, but it can be treated as a starting point. The response generated by OpenAI should only be taken
            as a suggestion. You should still explore the data and make adjustments as needed. </p>
    </div>
    <div id="loading-message" style="display:none;">
        <p>🤖 GPT 3.5 is generating the response... It might take up to 30 seconds ~ 1 minute. ⏳</p>
    </div>
    <div id="results">
        <h2>✨ Result:</h2>
        <pre id="cleaning-code"></pre>
    </div>
    <div id="creator">
        <p><strong>Creator:</strong> John Chen<br><strong>Contact:</strong> john0922ucb@berkeley.edu</p>
    </div>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script>
        $('form').submit(function (event) {
            event.preventDefault();
            var form_data = new FormData($('form')[0]);
            $('#loading-message').show(); // Show the loading message
            $.ajax({
                type: 'POST',
                url: '/',
                data: form_data,
                cache: false,
                contentType: false,
                processData: false,
                success: function (data) {
                    console.log(data);
                    $('#loading-message').hide(); // Hide the loading message
                    $('#cleaning-code').text(data.response);
                },
                error: function () {
                    $('#loading-message').hide(); // Hide the loading message
                    alert('Error occurred while uploading the file.');
                }
            });
        });
    </script>
</body>

</html>